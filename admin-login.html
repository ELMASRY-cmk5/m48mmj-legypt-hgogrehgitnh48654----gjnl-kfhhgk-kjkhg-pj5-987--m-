<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تسجيل دخول المشرف</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Cairo',sans-serif;background:linear-gradient(135deg,#1a0f08,#0d0605);color:#f5e6d3;min-height:100vh;display:flex;align-items:center;justify-content:center}
    .card{background:rgba(44,24,16,0.85);padding:26px;border-radius:10px;border:1px solid rgba(212,160,23,0.08);width:360px;max-width:92%}
    h1{color:#d4a017;text-align:center;margin-bottom:12px}
    label{display:block;margin-bottom:8px;color:#c4b5a0}
    input{width:100%;padding:10px;border-radius:6px;border:1px solid rgba(212,160,23,0.08);background:transparent;color:#f5e6d3;margin-bottom:12px}
    .btn{display:inline-block;padding:10px 14px;border-radius:8px;text-decoration:none;background:#d4a017;color:#1a0f08;border:none;cursor:pointer;font-weight:700}
    .hint{font-size:13px;color:#b89968;margin-top:8px;text-align:center}
    .err{color:#ffb3b3;text-align:center;margin-top:8px}
    a.back{display:block;text-align:center;margin-top:10px;color:#f5e6d3;text-decoration:none}
  </style>
</head>
<body>
  <div class="card">
    <h1>تسجيل دخول المشرف</h1>
    <form id="authForm">
      <label>البريد الإلكتروني</label>
      <input id="email" type="email" placeholder="admin@example.com" autocomplete="email">
      <label>كلمة السر</label>
      <input id="password" type="password" placeholder="••••••">
      <div style="display:flex;gap:8px;justify-content:center;margin-top:6px">
        <button id="loginBtn" class="btn" type="button">دخول</button>
      </div>
      <div id="err" class="err" role="alert" aria-live="assertive"></div>
    </form>
    <div class="hint">بعد تسجيل الدخول سيتم تحويلك إلى صفحة الأخبار لصلاحيات المشرف.</div>
    <a class="back" href="index.html">العودة للرئيسية</a>
  </div>

  <script type="module">
    // Firebase modular SDK (via CDN)
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyAoCN5aHni1iHXao8CzU8slajjfT1KQ1nU",
      authDomain: "news-app-d1919.firebaseapp.com",
      projectId: "news-app-d1919",
      storageBucket: "news-app-d1919.firebasestorage.app",
      messagingSenderId: "331877585684",
      appId: "1:331877585684:web:3b77ee0f4ebfced14d6801"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const emailInput = document.getElementById('email');
    const passInput = document.getElementById('password');
    const err = document.getElementById('err');
    const loginBtn = document.getElementById('loginBtn');

    function setLocalAuth(){
      localStorage.setItem('mf_admin_authenticated','1');
    }

    loginBtn.addEventListener('click', async () => {
      err.textContent = '';
      const email = (emailInput.value||'').trim();
      const pw = (passInput.value||'').trim();
      if(!email || !pw){ err.textContent = 'اكتب البريد وكلمة السر'; return; }
      try{
        await signInWithEmailAndPassword(auth, email, pw);
        // onAuthStateChanged will handle redirect
      }catch(e){
        err.textContent = e.message || 'فشل تسجيل الدخول';
      }
    });

    // Keep localStorage flag for compatibility with existing pages
    onAuthStateChanged(auth, user => {
      if(user){
        setLocalAuth();
        // Redirect to news page with admin=1
        window.location.href = 'news.html?admin=1';
      }
    });
  </script>
</body>
</html>
